<?xml version="1.0" encoding="iso-8859-1"?>
<!-- 
  Please see the license.html file included with this distribution for 
  attribution and copyright information.
-->

<root>
    <!-- advanced effects subwindow -->
    <windowclass name="advanced_effects_subwindow">
		<margins control="0,0,2,2" />
        <script>
            function onInit()
                local node = getDatabaseNode();
                local bIDentified = (DB.getValue(node, "isidentified", 0) > 0);
                local bPCEdit = OptionsManager.isOption("ADND_AE_EDIT", "enabled");
                local bIsPcItem = string.match(node.getPath(),"^charsheet") ~= null;
                local bCanEdit = false;
                
                if (bIsPcItem and bIDentified and bPCEdit) or 
                    (bIsPcItem and bPCEdit) then
                    bCanEdit = true;
                end
                
                if (User.isHost() or bCanEdit) then
                    header_effects.setVisible(true);
                    effects_iedit.setVisible(true);
                    effects_list_iadd.setVisible(false);
                    effects_list.setVisible(true);
                else
                    header_effects.setVisible(false);
                    effects_iedit.setVisible(false);
                    effects_list_iadd.setVisible(false);
                    effects_list.setVisible(false);
                end
            end
        </script>
		<sheetdata>
			<anchor_column name="columnanchor" />
            <!-- effects -->
			<header_column name="header_effects">
				<static textres="header_effects" />
				<center />
			</header_column>
			<button_iedit name="effects_iedit">
				<anchored to="header_effects" position="insidetopright" offset="-5,0" />
 				<script>
					function onValueChanged()
						local bEditMode = (getValue() ~= 0);
						
						window.effects_list_iadd.setVisible(bEditMode);
						window.effects_list.update();
					end
				</script>
			</button_iedit>
			<button_iadd name="effects_list_iadd">
				<anchored to="effects_iedit" position="lefthigh" offset="5,0" />
				<target>effects_list</target>
			</button_iadd>
            
			<list_editor_advanced_effects name="effects_list">
				<datasource>.effectlist</datasource>
				<class>advanced_effects_entry</class>
				<script>
					function addEntry(bFocus)
						local n = getWindowCount();
						
						local w = createWindow();
						return w;
					end
				</script>
			</list_editor_advanced_effects>
            <!-- end advanced effects entry -->
		</sheetdata>
    </windowclass>
</root>
